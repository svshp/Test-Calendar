"use strict";let storage={curentFormat:"YYYY-MM-DD",curentMonth:null,longPeriod:!1,tableEvents:null,startDate:null,endDate:null,outputDate:null};function setUpButtons(){document.querySelector(".block-header__btn-add").addEventListener("click",addEvent),document.querySelector(".block-header__btn-update").addEventListener("click",updateEvent),document.querySelector(".block-header__find_find").addEventListener("click",findEvents),document.querySelector(".section-dates__select-period_month-minus").addEventListener("click",monthMinus),document.querySelector(".section-dates__select-period_month-plus").addEventListener("click",monthPlus),document.querySelector(".section-dates__select-period_today").addEventListener("click",setToday)}function addEvent(){console.log("addEvent()")}function updateEvent(){localStorage.setItem("arrayEvents",JSON.stringify(storage.tableEvents))}function findEvents(){console.log("findEvents()")}function monthMinus(){let e=storage.longPeriod?6:5;storage.curentMonth=moment(storage.curentMonth).add(-1,"month"),calculateDates(),correctLayoutTable(e),outputPeriod(),fillTable()}function monthPlus(){let e=storage.longPeriod?6:5;storage.curentMonth=moment(storage.curentMonth).add(1,"month"),calculateDates(),correctLayoutTable(e),outputPeriod(),fillTable()}function setToday(){let e=storage.longPeriod?6:5;storage.curentMonth=moment().date(1).hours(0).minutes(0).seconds(0),calculateDates(),correctLayoutTable(e),outputPeriod(),fillTable()}function calculateDates(){let e=-(storage.curentMonth.day()-1);0===storage.curentMonth.day()&&(e=-6),storage.startDate=moment(storage.curentMonth).add(e,"days"),storage.endDate=moment(storage.startDate).add(42,"days").add(-1,"seconds"),storage.outputDate=moment(storage.startDate),storage.endDate.date()>6?(storage.endDate.add(-7,"days"),storage.longPeriod=!1):storage.longPeriod=!0}function buildLayoutTable(){let e=document.querySelector(".section-dates__table"),t=storage.longPeriod?6:5;for(let a=0;a<t;a++){let t=generateTableRow();t.classList.add("section-dates__table_row"),e.appendChild(t)}}function correctLayoutTable(e){let t=document.querySelector(".section-dates__table"),a=storage.longPeriod?6:5;if(a>e){let e=generateTableRow();e.classList.add("section-dates__table_row"),t.appendChild(e)}else if(a<e){generateTableRow();t.removeChild(t.lastChild)}}function generateTableRow(){let e=document.createElement("div");for(let t=0;t<7;t++){let t=generateTableRowCol();t.classList.add("section-dates__table_col"),e.appendChild(t)}return e}function generateTableRowCol(){let e=document.createElement("div"),t=document.createElement("span"),a=document.createElement("div"),o=document.createElement("div");return a.classList.add("section-dates__table_col-event"),o.classList.add("section-dates__table_col-participant"),e.appendChild(t),e.appendChild(a),e.appendChild(o),storage.outputDate.add(1,"days"),e}function outputPeriod(){document.querySelector(".section-dates__select-period_month-text").textContent=getSelectedPeriod()}function getSelectedPeriod(){return moment(storage.curentMonth).format("MMMM YYYY")}function fillTable(){storage.outputDate=moment(storage.startDate);let e=0,t=findFirstEventIndex(storage.outputDate),a=document.querySelector(".section-dates__table");for(let o=0;o<a.children.length;o++){let n=a.children[o];for(let a=0;a<n.children.length;a++){let o=n.children[a],s=o.querySelector("span");o.classList.remove("today"),o.classList.remove("event"),s.textContent=e<7?storage.outputDate.format("dddd")+", ":"",s.textContent+=storage.outputDate.date(),storage.outputDate.format(storage.curentFormat)===moment().hours(0).minutes(0).seconds(0).format(storage.curentFormat)&&o.classList.add("today");let r=o.querySelector(".section-dates__table_col-event");r.textContent="";let l=o.querySelector(".section-dates__table_col-participant");l.textContent="",-1!==t&&t<storage.tableEvents.length&&equalDates(t)&&(r.textContent=storage.tableEvents[t].title,o.classList.add("event"),addParticipants(l,t),t++),e++,storage.outputDate.add(1,"days")}}}function findFirstEventIndex(e){let t=-1;for(let a=0;a<storage.tableEvents.length;a++)if(moment(storage.tableEvents[a].date)>=moment(e)){t=a;break}return t}function equalDates(e){return moment(storage.tableEvents[e].date).hours(0).minutes(0).seconds(0).format(storage.curentFormat)===moment(storage.outputDate).hours(0).minutes(0).seconds(0).format(storage.curentFormat)}function addParticipants(e,t){let a=storage.tableEvents[t].participants.length,o="";for(let e=0;e<a;e++)o+=storage.tableEvents[t].participants[e].name+" "+storage.tableEvents[t].participants[e].surname,o+=e===a-1?".":", ";e.textContent=o}function readData(){if(storage.tableEvents=JSON.parse(localStorage.getItem("arrayEvents")),null===storage.tableEvents){let e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(storage.tableEvents=JSON.parse(e.responseText).events,storage.tableEvents.sort((e,t)=>moment(e.date)-moment(t.date)),fillTable())},e.open("GET","./events.json",!0),e.send()}else storage.tableEvents.sort((e,t)=>moment(e.date)-moment(t.date)),fillTable()}window.onload=function(){storage.curentMonth=moment().date(1).hours(0).minutes(0).seconds(0),setUpButtons(),calculateDates(),buildLayoutTable(),outputPeriod(),readData()};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsic3RvcmFnZSIsImN1cmVudEZvcm1hdCIsImN1cmVudE1vbnRoIiwibG9uZ1BlcmlvZCIsInRhYmxlRXZlbnRzIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsIm91dHB1dERhdGUiLCJzZXRVcEJ1dHRvbnMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiYWRkRXZlbnQiLCJ1cGRhdGVFdmVudCIsImZpbmRFdmVudHMiLCJtb250aE1pbnVzIiwibW9udGhQbHVzIiwic2V0VG9kYXkiLCJjb25zb2xlIiwibG9nIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwcmV2TWF4Um93cyIsIm1vbWVudCIsImFkZCIsImNhbGN1bGF0ZURhdGVzIiwiY29ycmVjdExheW91dFRhYmxlIiwib3V0cHV0UGVyaW9kIiwiZmlsbFRhYmxlIiwiZGF0ZSIsImhvdXJzIiwibWludXRlcyIsInNlY29uZHMiLCJzaGlmdERhdGUiLCJkYXkiLCJidWlsZExheW91dFRhYmxlIiwic2VjdGlvbkRhdGVzVGFibGUiLCJtYXhSb3dzIiwiaSIsInNlY3Rpb25EYXRlc1RhYmxlUm93IiwiZ2VuZXJhdGVUYWJsZVJvdyIsImNsYXNzTGlzdCIsImFwcGVuZENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJsYXN0Q2hpbGQiLCJ0YWJsZVJvdyIsImNyZWF0ZUVsZW1lbnQiLCJ5Iiwic2VjdGlvbkRhdGVzVGFibGVDb2wiLCJnZW5lcmF0ZVRhYmxlUm93Q29sIiwidGFibGVSb3dDb2wiLCJzcGFuIiwiZGl2MSIsImRpdjIiLCJ0ZXh0Q29udGVudCIsImdldFNlbGVjdGVkUGVyaW9kIiwiZm9ybWF0IiwiY291bnREYXRlIiwiZmlyc3RFdmVudEluZGV4IiwiZmluZEZpcnN0RXZlbnRJbmRleCIsImN1clRhYmxlIiwiciIsImNoaWxkcmVuIiwibGVuZ3RoIiwiY2hpbGRyZW5Sb3ciLCJjIiwiY3VyVGFibGVDb2wiLCJjdXJUYWJsZUNvbFNwYW4iLCJyZW1vdmUiLCJjdXJUYWJsZUNvbEV2ZW50IiwiY3VyVGFibGVDb2xQYXJ0aWNpcGFudHMiLCJlcXVhbERhdGVzIiwidGl0bGUiLCJhZGRQYXJ0aWNpcGFudHMiLCJjdXJJbmRleCIsInF1YW50UGFydGljaXBhbnRzIiwicGFydGljaXBhbnRzIiwibGlzdFBhcnRpY2lwYW50cyIsIm5hbWUiLCJzdXJuYW1lIiwicmVhZERhdGEiLCJwYXJzZSIsImdldEl0ZW0iLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXNwb25zZVRleHQiLCJldmVudHMiLCJzb3J0IiwiZmlyc3QiLCJzZWNvbmQiLCJvcGVuIiwic2VuZCIsIndpbmRvdyIsIm9ubG9hZCJdLCJtYXBwaW5ncyI6IkFBQUEsYUFLQSxJQUFBQSxRQUFBLENBQ0FDLGFBQUEsYUFDQUMsWUFBQSxLQUNBQyxZQUFBLEVBQ0FDLFlBQUEsS0FDQUMsVUFBQSxLQUNBQyxRQUFBLEtBQ0FDLFdBQUEsTUFrQkEsU0FBQUMsZUFDQUMsU0FBQUMsY0FBQSwwQkFDQUMsaUJBQUEsUUFBQUMsVUFFQUgsU0FBQUMsY0FBQSw2QkFDQUMsaUJBQUEsUUFBQUUsYUFFQUosU0FBQUMsY0FBQSw0QkFDQUMsaUJBQUEsUUFBQUcsWUFFQUwsU0FBQUMsY0FBQSw2Q0FDQUMsaUJBQUEsUUFBQUksWUFFQU4sU0FBQUMsY0FBQSw0Q0FDQUMsaUJBQUEsUUFBQUssV0FFQVAsU0FBQUMsY0FBQSx1Q0FDQUMsaUJBQUEsUUFBQU0sVUFHQSxTQUFBTCxXQUNBTSxRQUFBQyxJQUFBLGNBR0EsU0FBQU4sY0FDQU8sYUFBQUMsUUFBQSxjQUFBQyxLQUFBQyxVQUFBdkIsUUFBQUksY0FHQSxTQUFBVSxhQUNBSSxRQUFBQyxJQUFBLGdCQUdBLFNBQUFKLGFBQ0EsSUFBQVMsRUFBQXhCLFFBQUFHLFdBQUEsRUFBQSxFQUVBSCxRQUFBRSxZQUFBdUIsT0FBQXpCLFFBQUFF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dXNlIHN0cmljdCdcclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vLyB2YXJcclxuXHJcbmxldCBzdG9yYWdlID0ge1xyXG4gICAgY3VyZW50Rm9ybWF0OiAnWVlZWS1NTS1ERCcsXHJcbiAgICBjdXJlbnRNb250aDogbnVsbCxcclxuICAgIGxvbmdQZXJpb2Q6IGZhbHNlLFxyXG4gICAgdGFibGVFdmVudHM6IG51bGwsXHJcbiAgICBzdGFydERhdGU6IG51bGwsXHJcbiAgICBlbmREYXRlOiBudWxsLFxyXG4gICAgb3V0cHV0RGF0ZTogbnVsbFxyXG59XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuXHJcbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBzdG9yYWdlLmN1cmVudE1vbnRoID0gbW9tZW50KCkuZGF0ZSgxKS5ob3VycygwKS5taW51dGVzKDApLnNlY29uZHMoMCk7XHJcblxyXG4gICAgc2V0VXBCdXR0b25zKCk7XHJcbiAgICBjYWxjdWxhdGVEYXRlcygpO1xyXG4gICAgYnVpbGRMYXlvdXRUYWJsZSgpO1xyXG4gICAgb3V0cHV0UGVyaW9kKCk7XHJcbiAgICByZWFkRGF0YSgpO1xyXG59XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuLy8gRXZlbnRzXHJcblxyXG5mdW5jdGlvbiBzZXRVcEJ1dHRvbnMoKSB7XHJcbiAgICBsZXQgYnRuQWRkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJsb2NrLWhlYWRlcl9fYnRuLWFkZCcpO1xyXG4gICAgYnRuQWRkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkRXZlbnQpO1xyXG5cclxuICAgIGxldCBidG5VcGRhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxvY2staGVhZGVyX19idG4tdXBkYXRlJyk7XHJcbiAgICBidG5VcGRhdGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB1cGRhdGVFdmVudCk7XHJcblxyXG4gICAgbGV0IGJ0bkZpbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxvY2staGVhZGVyX19maW5kX2ZpbmQnKTtcclxuICAgIGJ0bkZpbmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmaW5kRXZlbnRzKTtcclxuXHJcbiAgICBsZXQgYnRuTW9udGhNaW51cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX19zZWxlY3QtcGVyaW9kX21vbnRoLW1pbnVzJyk7XHJcbiAgICBidG5Nb250aE1pbnVzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbW9udGhNaW51cyk7XHJcblxyXG4gICAgbGV0IGJ0bk1vbnRoUGx1cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX19zZWxlY3QtcGVyaW9kX21vbnRoLXBsdXMnKTtcclxuICAgIGJ0bk1vbnRoUGx1cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG1vbnRoUGx1cyk7XHJcblxyXG4gICAgbGV0IGJ0blRvZGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tZGF0ZXNfX3NlbGVjdC1wZXJpb2RfdG9kYXknKTtcclxuICAgIGJ0blRvZGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2V0VG9kYXkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRFdmVudCgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdhZGRFdmVudCgpJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUV2ZW50KCkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FycmF5RXZlbnRzJywgSlNPTi5zdHJpbmdpZnkoc3RvcmFnZS50YWJsZUV2ZW50cykpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmaW5kRXZlbnRzKCkge1xyXG4gICAgY29uc29sZS5sb2coJ2ZpbmRFdmVudHMoKScpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtb250aE1pbnVzKCkge1xyXG4gICAgbGV0IHByZXZNYXhSb3dzID0gc3RvcmFnZS5sb25nUGVyaW9kID8gNiA6IDU7XHJcblxyXG4gICAgc3RvcmFnZS5jdXJlbnRNb250aCA9IG1vbWVudChzdG9yYWdlLmN1cmVudE1vbnRoKS5hZGQoLTEsICdtb250aCcpO1xyXG5cclxuICAgIGNhbGN1bGF0ZURhdGVzKCk7XHJcbiAgICBjb3JyZWN0TGF5b3V0VGFibGUocHJldk1heFJvd3MpO1xyXG4gICAgb3V0cHV0UGVyaW9kKCk7XHJcbiAgICBmaWxsVGFibGUoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbW9udGhQbHVzKCkge1xyXG4gICAgbGV0IHByZXZNYXhSb3dzID0gc3RvcmFnZS5sb25nUGVyaW9kID8gNiA6IDU7XHJcblxyXG4gICAgc3RvcmFnZS5jdXJlbnRNb250aCA9IG1vbWVudChzdG9yYWdlLmN1cmVudE1vbnRoKS5hZGQoKzEsICdtb250aCcpO1xyXG5cclxuICAgIGNhbGN1bGF0ZURhdGVzKCk7XHJcbiAgICBjb3JyZWN0TGF5b3V0VGFibGUocHJldk1heFJvd3MpO1xyXG4gICAgb3V0cHV0UGVyaW9kKCk7XHJcbiAgICBmaWxsVGFibGUoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0VG9kYXkoKSB7XHJcbiAgICBsZXQgcHJldk1heFJvd3MgPSBzdG9yYWdlLmxvbmdQZXJpb2QgPyA2IDogNTtcclxuXHJcbiAgICBzdG9yYWdlLmN1cmVudE1vbnRoID0gbW9tZW50KCkuZGF0ZSgxKS5ob3VycygwKS5taW51dGVzKDApLnNlY29uZHMoMCk7XHJcblxyXG4gICAgY2FsY3VsYXRlRGF0ZXMoKTtcclxuICAgIGNvcnJlY3RMYXlvdXRUYWJsZShwcmV2TWF4Um93cyk7XHJcbiAgICBvdXRwdXRQZXJpb2QoKTtcclxuICAgIGZpbGxUYWJsZSgpO1xyXG59XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZURhdGVzKCkge1xyXG4gICAgbGV0IHNoaWZ0RGF0ZSA9IC0oc3RvcmFnZS5jdXJlbnRNb250aC5kYXkoKSAtIDEpO1xyXG5cclxuICAgIGlmIChzdG9yYWdlLmN1cmVudE1vbnRoLmRheSgpID09PSAwKSB7XHJcbiAgICAgICAgc2hpZnREYXRlID0gLTY7XHJcbiAgICB9XHJcblxyXG4gICAgc3RvcmFnZS5zdGFydERhdGUgPSBtb21lbnQoc3RvcmFnZS5jdXJlbnRNb250aCkuYWRkKHNoaWZ0RGF0ZSwgJ2RheXMnKTtcclxuICAgIHN0b3JhZ2UuZW5kRGF0ZSA9IG1vbWVudChzdG9yYWdlLnN0YXJ0RGF0ZSkuYWRkKDQyLCAnZGF5cycpLmFkZCgtMSwnc2Vjb25kcycpO1xyXG4gICAgc3RvcmFnZS5vdXRwdXREYXRlID0gbW9tZW50KHN0b3JhZ2Uuc3RhcnREYXRlKTtcclxuXHJcbiAgICBpZiAoc3RvcmFnZS5lbmREYXRlLmRhdGUoKSA+IDYgKSB7XHJcbiAgICAgICAgc3RvcmFnZS5lbmREYXRlLmFkZCgtNywgJ2RheXMnKTtcclxuICAgICAgICBzdG9yYWdlLmxvbmdQZXJpb2QgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgICAgc3RvcmFnZS5sb25nUGVyaW9kID0gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYnVpbGRMYXlvdXRUYWJsZSgpIHtcclxuICAgIGxldCBzZWN0aW9uRGF0ZXNUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX190YWJsZScpO1xyXG5cclxuICAgIGxldCBtYXhSb3dzID0gc3RvcmFnZS5sb25nUGVyaW9kID8gNiA6IDU7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhSb3dzOyBpKyspIHtcclxuICAgICAgICBsZXQgc2VjdGlvbkRhdGVzVGFibGVSb3cgPSBnZW5lcmF0ZVRhYmxlUm93KCk7XHJcbiAgICAgICAgc2VjdGlvbkRhdGVzVGFibGVSb3cuY2xhc3NMaXN0LmFkZCgnc2VjdGlvbi1kYXRlc19fdGFibGVfcm93Jyk7XHJcblxyXG4gICAgICAgIHNlY3Rpb25EYXRlc1RhYmxlLmFwcGVuZENoaWxkKHNlY3Rpb25EYXRlc1RhYmxlUm93KTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29ycmVjdExheW91dFRhYmxlKHByZXZNYXhSb3dzKSB7XHJcbiAgICBsZXQgc2VjdGlvbkRhdGVzVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi1kYXRlc19fdGFibGUnKTtcclxuXHJcbiAgICBsZXQgbWF4Um93cyA9IHN0b3JhZ2UubG9uZ1BlcmlvZCA/IDYgOiA1O1xyXG5cclxuICAgIGlmIChtYXhSb3dzID4gcHJldk1heFJvd3MpIHtcclxuICAgICAgICBsZXQgc2VjdGlvbkRhdGVzVGFibGVSb3cgPSBnZW5lcmF0ZVRhYmxlUm93KCk7XHJcbiAgICAgICAgc2VjdGlvbkRhdGVzVGFibGVSb3cuY2xhc3NMaXN0LmFkZCgnc2VjdGlvbi1kYXRlc19fdGFibGVfcm93Jyk7XHJcblxyXG4gICAgICAgIHNlY3Rpb25EYXRlc1RhYmxlLmFwcGVuZENoaWxkKHNlY3Rpb25EYXRlc1RhYmxlUm93KTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKG1heFJvd3MgPCBwcmV2TWF4Um93cykge1xyXG4gICAgICAgIGxldCBzZWN0aW9uRGF0ZXNUYWJsZVJvdyA9IGdlbmVyYXRlVGFibGVSb3coKTtcclxuXHJcbiAgICAgICAgc2VjdGlvbkRhdGVzVGFibGUucmVtb3ZlQ2hpbGQoc2VjdGlvbkRhdGVzVGFibGUubGFzdENoaWxkKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVUYWJsZVJvdygpIHtcclxuICAgIGxldCB0YWJsZVJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7XHJcblxyXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCA3OyB5KyspIHtcclxuICAgICAgICBsZXQgc2VjdGlvbkRhdGVzVGFibGVDb2wgPSBnZW5lcmF0ZVRhYmxlUm93Q29sKCk7XHJcbiAgICAgICAgc2VjdGlvbkRhdGVzVGFibGVDb2wuY2xhc3NMaXN0LmFkZCgnc2VjdGlvbi1kYXRlc19fdGFibGVfY29sJyk7XHJcblxyXG4gICAgICAgIHRhYmxlUm93LmFwcGVuZENoaWxkKHNlY3Rpb25EYXRlc1RhYmxlQ29sKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGFibGVSb3c7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlVGFibGVSb3dDb2woKSB7XHJcbiAgICBsZXQgdGFibGVSb3dDb2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApO1xyXG4gICAgbGV0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnc3BhbicgKTtcclxuICAgIGxldCBkaXYxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTtcclxuICAgIGxldCBkaXYyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTtcclxuXHJcbiAgICBkaXYxLmNsYXNzTGlzdC5hZGQoJ3NlY3Rpb24tZGF0ZXNfX3RhYmxlX2NvbC1ldmVudCcpO1xyXG4gICAgZGl2Mi5jbGFzc0xpc3QuYWRkKCdzZWN0aW9uLWRhdGVzX190YWJsZV9jb2wtcGFydGljaXBhbnQnKTtcclxuXHJcbiAgICB0YWJsZVJvd0NvbC5hcHBlbmRDaGlsZChzcGFuKTtcclxuICAgIHRhYmxlUm93Q29sLmFwcGVuZENoaWxkKGRpdjEpO1xyXG4gICAgdGFibGVSb3dDb2wuYXBwZW5kQ2hpbGQoZGl2Mik7XHJcblxyXG4gICAgc3RvcmFnZS5vdXRwdXREYXRlLmFkZCgxLCAnZGF5cycpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gdGFibGVSb3dDb2w7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG91dHB1dFBlcmlvZCgpIHtcclxuICAgIGxldCBzZWxlY3RlZFBlcmlvZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX19zZWxlY3QtcGVyaW9kX21vbnRoLXRleHQnKTtcclxuICAgIHNlbGVjdGVkUGVyaW9kLnRleHRDb250ZW50ID0gZ2V0U2VsZWN0ZWRQZXJpb2QoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0U2VsZWN0ZWRQZXJpb2QoKSB7XHJcbiAgICAvLyBtb21lbnQubG9jYWxlKCdydScpO1xyXG4gICAgcmV0dXJuIG1vbWVudChzdG9yYWdlLmN1cmVudE1vbnRoKS5mb3JtYXQoJ01NTU0gWVlZWScpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmaWxsVGFibGUoKSB7XHJcbiAgICBzdG9yYWdlLm91dHB1dERhdGUgPSBtb21lbnQoc3RvcmFnZS5zdGFydERhdGUpO1xyXG5cclxuICAgIGxldCBjb3VudERhdGUgPSAwO1xyXG4gICAgbGV0IGZpcnN0RXZlbnRJbmRleCA9IGZpbmRGaXJzdEV2ZW50SW5kZXgoc3RvcmFnZS5vdXRwdXREYXRlKTtcclxuXHJcbiAgICBsZXQgY3VyVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi1kYXRlc19fdGFibGUnKTtcclxuXHJcbiAgICBmb3IgKGxldCByID0gMDsgciA8IGN1clRhYmxlLmNoaWxkcmVuLmxlbmd0aDsgcisrKSB7XHJcbiAgICAgICAgbGV0IGNoaWxkcmVuUm93ID0gY3VyVGFibGUuY2hpbGRyZW5bcl07XHJcblxyXG4gICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgY2hpbGRyZW5Sb3cuY2hpbGRyZW4ubGVuZ3RoOyBjKyspIHtcclxuICAgICAgICAgICAgbGV0IGN1clRhYmxlQ29sID0gY2hpbGRyZW5Sb3cuY2hpbGRyZW5bY107XHJcbiAgICAgICAgICAgIGxldCBjdXJUYWJsZUNvbFNwYW4gPSBjdXJUYWJsZUNvbC5xdWVyeVNlbGVjdG9yKCdzcGFuJyk7XHJcblxyXG4gICAgICAgICAgICBjdXJUYWJsZUNvbC5jbGFzc0xpc3QucmVtb3ZlKCd0b2RheScpO1xyXG4gICAgICAgICAgICBjdXJUYWJsZUNvbC5jbGFzc0xpc3QucmVtb3ZlKCdldmVudCcpO1xyXG5cclxuICAgICAgICAgICAgY3VyVGFibGVDb2xTcGFuLnRleHRDb250ZW50ID0gY291bnREYXRlIDwgNyA/IHN0b3JhZ2Uub3V0cHV0RGF0ZS5mb3JtYXQoJ2RkZGQnKSArICcsICcgOiAnJztcclxuICAgICAgICAgICAgY3VyVGFibGVDb2xTcGFuLnRleHRDb250ZW50ICs9IHN0b3JhZ2Uub3V0cHV0RGF0ZS5kYXRlKCk7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKHN0b3JhZ2Uub3V0cHV0RGF0ZS5mb3JtYXQoc3RvcmFnZS5jdXJlbnRGb3JtYXQpID09PSBtb21lbnQoKS5ob3VycygwKS5taW51dGVzKDApLnNlY29uZHMoMCkuZm9ybWF0KHN0b3JhZ2UuY3VyZW50Rm9ybWF0KSkge1xyXG4gICAgICAgICAgICAgICAgY3VyVGFibGVDb2wuY2xhc3NMaXN0LmFkZCgndG9kYXknKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGV0IGN1clRhYmxlQ29sRXZlbnQgPSBjdXJUYWJsZUNvbC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi1kYXRlc19fdGFibGVfY29sLWV2ZW50Jyk7XHJcbiAgICAgICAgICAgIGN1clRhYmxlQ29sRXZlbnQudGV4dENvbnRlbnQgPSAnJztcclxuICAgICAgICAgICAgbGV0IGN1clRhYmxlQ29sUGFydGljaXBhbnRzID0gY3VyVGFibGVDb2wucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tZGF0ZXNfX3RhYmxlX2NvbC1wYXJ0aWNpcGFudCcpO1xyXG4gICAgICAgICAgICBjdXJUYWJsZUNvbFBhcnRpY2lwYW50cy50ZXh0Q29udGVudCA9ICcnO1xyXG5cclxuICAgICAgICAgICAgaWYgKChmaXJzdEV2ZW50SW5kZXggIT09IC0xKSAmJiAoZmlyc3RFdmVudEluZGV4IDwgc3RvcmFnZS50YWJsZUV2ZW50cy5sZW5ndGgpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXF1YWxEYXRlcyhmaXJzdEV2ZW50SW5kZXgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VyVGFibGVDb2xFdmVudC50ZXh0Q29udGVudCA9IHN0b3JhZ2UudGFibGVFdmVudHNbZmlyc3RFdmVudEluZGV4XS50aXRsZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY3VyVGFibGVDb2wuY2xhc3NMaXN0LmFkZCgnZXZlbnQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYWRkUGFydGljaXBhbnRzKGN1clRhYmxlQ29sUGFydGljaXBhbnRzLCBmaXJzdEV2ZW50SW5kZXgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmaXJzdEV2ZW50SW5kZXgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY291bnREYXRlKys7XHJcbiAgICAgICAgICAgIHN0b3JhZ2Uub3V0cHV0RGF0ZS5hZGQoMSwgJ2RheXMnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbmRGaXJzdEV2ZW50SW5kZXgoc3RhcnREYXRlKSB7XHJcbiAgICBsZXQgY3VySW5kZXggPSAtMTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0b3JhZ2UudGFibGVFdmVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAobW9tZW50KHN0b3JhZ2UudGFibGVFdmVudHNbaV0uZGF0ZSkgPj0gbW9tZW50KHN0YXJ0RGF0ZSkpIHtcclxuICAgICAgICAgICAgY3VySW5kZXggPSBpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGN1ckluZGV4O1xyXG59XHJcblxyXG5mdW5jdGlvbiBlcXVhbERhdGVzKGZpcnN0RXZlbnRJbmRleCkge1xyXG4gICAgcmV0dXJuIG1vbWVudChzdG9yYWdlLnRhYmxlRXZlbnRzW2ZpcnN0RXZlbnRJbmRleF0uZGF0ZSkuaG91cnMoMCkubWludXRlcygwKS5zZWNvbmRzKDApLmZvcm1hdChzdG9yYWdlLmN1cmVudEZvcm1hdClcclxuICAgICAgICAgICA9PT0gbW9tZW50KHN0b3JhZ2Uub3V0cHV0RGF0ZSkuaG91cnMoMCkubWludXRlcygwKS5zZWNvbmRzKDApLmZvcm1hdChzdG9yYWdlLmN1cmVudEZvcm1hdCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFkZFBhcnRpY2lwYW50cyhjdXJUYWJsZUNvbFBhcnRpY2lwYW50cywgZmlyc3RFdmVudEluZGV4KSB7XHJcbiAgICBsZXQgcXVhbnRQYXJ0aWNpcGFudHMgPSBzdG9yYWdlLnRhYmxlRXZlbnRzW2ZpcnN0RXZlbnRJbmRleF0ucGFydGljaXBhbnRzLmxlbmd0aDtcclxuXHJcbiAgICBsZXQgbGlzdFBhcnRpY2lwYW50cyA9ICcnO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVhbnRQYXJ0aWNpcGFudHM7IGkrKykge1xyXG4gICAgICAgIGxpc3RQYXJ0aWNpcGFudHMgKz0gc3RvcmFnZS50YWJsZUV2ZW50c1tmaXJzdEV2ZW50SW5kZXhdLnBhcnRpY2lwYW50c1tpXS5uYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICArICcgJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKyBzdG9yYWdlLnRhYmxlRXZlbnRzW2ZpcnN0RXZlbnRJbmRleF0ucGFydGljaXBhbnRzW2ldLnN1cm5hbWU7XHJcblxyXG4gICAgICAgIGlmIChpID09PSAocXVhbnRQYXJ0aWNpcGFudHMgLSAxKSkge1xyXG4gICAgICAgICAgICBsaXN0UGFydGljaXBhbnRzICs9ICcuJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxpc3RQYXJ0aWNpcGFudHMgKz0gJywgJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY3VyVGFibGVDb2xQYXJ0aWNpcGFudHMudGV4dENvbnRlbnQgPSBsaXN0UGFydGljaXBhbnRzO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZWFkRGF0YSgpIHtcclxuICAgIHN0b3JhZ2UudGFibGVFdmVudHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhcnJheUV2ZW50cycpKTtcclxuXHJcbiAgICBpZiAoc3RvcmFnZS50YWJsZUV2ZW50cyA9PT0gbnVsbCkge1xyXG4gICAgICAgIGxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuXHJcbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZS50YWJsZUV2ZW50cyA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCkuZXZlbnRzO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZS50YWJsZUV2ZW50cy5zb3J0KChmaXJzdCwgc2Vjb25kKSA9PiAobW9tZW50KGZpcnN0LmRhdGUpIC0gbW9tZW50KHNlY29uZC5kYXRlKSkpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbFRhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICB4aHIub3BlbignR0VUJywgJy4vZXZlbnRzLmpzb24nLCB0cnVlKTtcclxuICAgICAgICB4aHIuc2VuZCgpO1xyXG4gICAgICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHN0b3JhZ2UudGFibGVFdmVudHMuc29ydCgoZmlyc3QsIHNlY29uZCkgPT4gKG1vbWVudChmaXJzdC5kYXRlKSAtIG1vbWVudChzZWNvbmQuZGF0ZSkpKTtcclxuXHJcbiAgICAgICAgZmlsbFRhYmxlKCk7XHJcbiAgICB9XHJcbn0iXX0=
