"use strict";let storage={curentFormat:"YYYY-MM-DD",curentMonth:null,longPeriod:!1,tableEvents:null,startDate:null,endDate:null,outputDate:null};function setUpButtons(){document.querySelector(".block-header__btn-add").addEventListener("click",addEvent),document.querySelector(".block-header__btn-update").addEventListener("click",updateEvent),document.querySelector(".block-header__find_field").addEventListener("keyup",fieldFindEvents),document.querySelector(".block-header__find_btn-clear").addEventListener("click",fieldFindBtnClear),document.querySelector(".section-dates__select-period_month-minus").addEventListener("click",monthMinus),document.querySelector(".section-dates__select-period_month-plus").addEventListener("click",monthPlus),document.querySelector(".section-dates__select-period_today").addEventListener("click",setToday)}function addEvent(){console.log("addEvent()")}function updateEvent(){localStorage.setItem("arrayEvents",JSON.stringify(storage.tableEvents))}function findEvents(){let e=document.querySelector(".block-header__find_field"),t=searchTitleEvents();t.style.top=e.offsetTop+e.offsetHeight+13+"px",t.style.left=e.offsetLeft+"px",t.style.display="block"}function searchTitleEvents(){let e=getFindEvents(),t=document.querySelector(".block-header__find_field").value.toLowerCase(),n=storage.tableEvents.filter(e=>-1!==e.title.toLowerCase().search(t));for(let t=0;t<n.length;t++){let o=document.createElement("div");o.classList.add("find-events__row");let a=document.createElement("div");a.textContent=n[t].title,a.classList.add("find-events__row_title");let l=document.createElement("div");l.textContent=moment(n[t].date).format("Do MMMM"),l.classList.add("find-events__row_Info"),o.appendChild(a),o.appendChild(l),e.appendChild(o)}return e}function getFindEvents(){let e=document.querySelector(".find-events");for(;e.hasChildNodes();)e.removeChild(e.firstChild);return e}function fieldFindEvents(e){let t=document.querySelector(".block-header__find_field").value,n=document.querySelector(".block-header__find_btn-clear");t.length<3?(n.style.color="#fff",hideFindEvents()):(n.style.color="#000",findEvents())}function fieldFindBtnClear(){document.querySelector(".block-header__find_field").value="",hideFindEvents();let e=document.querySelector(".block-header__find_btn-clear");e.style.color="#fff",e.blur()}function hideFindEvents(){document.querySelector(".find-events").style.display="none"}function monthMinus(){let e=storage.longPeriod?6:5;storage.curentMonth=moment(storage.curentMonth).add(-1,"month"),calculateDates(),correctLayoutTable(e),outputPeriod(),fillTable()}function monthPlus(){let e=storage.longPeriod?6:5;storage.curentMonth=moment(storage.curentMonth).add(1,"month"),calculateDates(),correctLayoutTable(e),outputPeriod(),fillTable()}function setToday(){let e=storage.longPeriod?6:5;storage.curentMonth=moment().date(1).hours(0).minutes(0).seconds(0),calculateDates(),correctLayoutTable(e),outputPeriod(),fillTable()}function calculateDates(){let e=-(storage.curentMonth.day()-1);0===storage.curentMonth.day()&&(e=-6),storage.startDate=moment(storage.curentMonth).add(e,"days"),storage.endDate=moment(storage.startDate).add(42,"days").add(-1,"seconds"),storage.outputDate=moment(storage.startDate),storage.endDate.date()>6?(storage.endDate.add(-7,"days"),storage.longPeriod=!1):storage.longPeriod=!0}function buildLayoutTable(){let e=document.querySelector(".section-dates__table"),t=storage.longPeriod?6:5;for(let n=0;n<t;n++){let t=generateTableRow();t.classList.add("section-dates__table_row"),e.appendChild(t)}}function correctLayoutTable(e){let t=document.querySelector(".section-dates__table"),n=storage.longPeriod?6:5;if(n>e){let e=generateTableRow();e.classList.add("section-dates__table_row"),t.appendChild(e)}else if(n<e){generateTableRow();t.removeChild(t.lastChild)}}function generateTableRow(){let e=document.createElement("div");for(let t=0;t<7;t++){let t=generateTableRowCol();t.classList.add("section-dates__table_col"),e.appendChild(t)}return e}function generateTableRowCol(){let e=document.createElement("div"),t=document.createElement("span"),n=document.createElement("div"),o=document.createElement("div");return n.classList.add("section-dates__table_col-event"),o.classList.add("section-dates__table_col-participant"),e.appendChild(t),e.appendChild(n),e.appendChild(o),storage.outputDate.add(1,"days"),e}function outputPeriod(){document.querySelector(".section-dates__select-period_month-text").textContent=getSelectedPeriod()}function getSelectedPeriod(){return moment(storage.curentMonth).format("MMMM YYYY")}function fillTable(){storage.outputDate=moment(storage.startDate);let e=0,t=findFirstEventIndex(storage.outputDate),n=document.querySelector(".section-dates__table");for(let o=0;o<n.children.length;o++){let a=n.children[o];for(let n=0;n<a.children.length;n++){let o=a.children[n],l=o.querySelector("span");o.classList.remove("today"),o.classList.remove("event"),l.textContent=e<7?storage.outputDate.format("dddd")+", ":"",l.textContent+=storage.outputDate.date(),storage.outputDate.format(storage.curentFormat)===moment().hours(0).minutes(0).seconds(0).format(storage.curentFormat)&&o.classList.add("today");let r=o.querySelector(".section-dates__table_col-event");r.textContent="";let s=o.querySelector(".section-dates__table_col-participant");s.textContent="",-1!==t&&t<storage.tableEvents.length&&equalDates(t)&&(r.textContent=storage.tableEvents[t].title,o.classList.add("event"),addParticipants(s,t),t++),e++,storage.outputDate.add(1,"days")}}}function findFirstEventIndex(e){let t=-1;for(let n=0;n<storage.tableEvents.length;n++)if(moment(storage.tableEvents[n].date)>=moment(e)){t=n;break}return t}function equalDates(e){return moment(storage.tableEvents[e].date).hours(0).minutes(0).seconds(0).format(storage.curentFormat)===moment(storage.outputDate).hours(0).minutes(0).seconds(0).format(storage.curentFormat)}function addParticipants(e,t){let n=storage.tableEvents[t].participants.length,o="";for(let e=0;e<n;e++)o+=storage.tableEvents[t].participants[e].name+" "+storage.tableEvents[t].participants[e].surname,o+=e===n-1?".":", ";e.textContent=o}function readData(){if(storage.tableEvents=JSON.parse(localStorage.getItem("arrayEvents")),null===storage.tableEvents){let e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(storage.tableEvents=JSON.parse(e.responseText).events,storage.tableEvents.sort((e,t)=>moment(e.date)-moment(t.date)),fillTable())},e.open("GET","./events.json",!0),e.send()}else storage.tableEvents.sort((e,t)=>moment(e.date)-moment(t.date)),fillTable()}window.onload=function(){storage.curentMonth=moment().date(1).hours(0).minutes(0).seconds(0),setUpButtons(),calculateDates(),buildLayoutTable(),outputPeriod(),readData()};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsic3RvcmFnZSIsImN1cmVudEZvcm1hdCIsImN1cmVudE1vbnRoIiwibG9uZ1BlcmlvZCIsInRhYmxlRXZlbnRzIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsIm91dHB1dERhdGUiLCJzZXRVcEJ1dHRvbnMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiYWRkRXZlbnQiLCJ1cGRhdGVFdmVudCIsImZpZWxkRmluZEV2ZW50cyIsImZpZWxkRmluZEJ0bkNsZWFyIiwibW9udGhNaW51cyIsIm1vbnRoUGx1cyIsInNldFRvZGF5IiwiY29uc29sZSIsImxvZyIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiZmluZEV2ZW50cyIsInNlYXJjaFRpdGxlRXZlbnRzIiwic3R5bGUiLCJ0b3AiLCJvZmZzZXRUb3AiLCJvZmZzZXRIZWlnaHQiLCJsZWZ0Iiwib2Zmc2V0TGVmdCIsImRpc3BsYXkiLCJnZXRGaW5kRXZlbnRzIiwic2VhcmNoVmFsdWUiLCJ2YWx1ZSIsInRvTG93ZXJDYXNlIiwicmVzdWx0U2VhcmNoIiwiZmlsdGVyIiwiaXRlbSIsInRpdGxlIiwic2VhcmNoIiwiaSIsImxlbmd0aCIsImZpbmRFdmVudHNSb3ciLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwicm93VGl0bGUiLCJ0ZXh0Q29udGVudCIsInJvd0luZm8iLCJtb21lbnQiLCJkYXRlIiwiZm9ybWF0IiwiYXBwZW5kQ2hpbGQiLCJoYXNDaGlsZE5vZGVzIiwicmVtb3ZlQ2hpbGQiLCJmaXJzdENoaWxkIiwiZSIsInNlYXJjaGluZ1RleHQiLCJidG5DbGVhciIsImNvbG9yIiwiaGlkZUZpbmRFdmVudHMiLCJibHVyIiwicHJldk1heFJvd3MiLCJjYWxjdWxhdGVEYXRlcyIsImNvcnJlY3RMYXlvdXRUYWJsZSIsIm91dHB1dFBlcmlvZCIsImZpbGxUYWJsZSIsImhvdXJzIiwibWludXRlcyIsInNlY29uZHMiLCJzaGlmdERhdGUiLCJkYXkiLCJidWlsZExheW91dFRhYmxlIiwic2VjdGlvbkRhdGVzVGFibGUiLCJtYXhSb3dzIiwic2VjdGlvbkRhdGVzVGFibGVSb3ciLCJnZW5lcmF0ZVRhYmxlUm93IiwibGFzdENoaWxkIiwidGFibGVSb3ciLCJ5Iiwic2VjdGlvbkRhdGVzVGFibGVDb2wiLCJnZW5lcmF0ZVRhYmxlUm93Q29sIiwidGFibGVSb3dDb2wiLCJzcGFuIiwiZGl2MSIsImRpdjIiLCJnZXRTZWxlY3RlZFBlcmlvZCIsImNvdW50RGF0ZSIsImZpcnN0RXZlbnRJbmRleCIsImZpbmRGaXJzdEV2ZW50SW5kZXgiLCJjdXJUYWJsZSIsInIiLCJjaGlsZHJlbiIsImNoaWxkcmVuUm93IiwiYyIsImN1clRhYmxlQ29sIiwiY3VyVGFibGVDb2xTcGFuIiwicmVtb3ZlIiwiY3VyVGFibGVDb2xFdmVudCIsImN1clRhYmxlQ29sUGFydGljaXBhbnRzIiwiZXF1YWxEYXRlcyIsImFkZFBhcnRpY2lwYW50cyIsImN1ckluZGV4IiwicXVhbnRQYXJ0aWNpcGFudHMiLCJwYXJ0aWNpcGFudHMiLCJsaXN0UGFydGljaXBhbnRzIiwibmFtZSIsInN1cm5hbWUiLCJyZWFkRGF0YSIsInBhcnNlIiwiZ2V0SXRlbSIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3BvbnNlVGV4dCIsImV2ZW50cyIsInNvcnQiLCJmaXJzdCIsInNlY29uZCIsIm9wZW4iLCJzZW5kIiwid2luZG93Iiwib25sb2FkIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUtBLElBQUFBLFFBQUEsQ0FDQUMsYUFBQSxhQUNBQyxZQUFBLEtBQ0FDLFlBQUEsRUFDQUMsWUFBQSxLQUNBQyxVQUFBLEtBQ0FDLFFBQUEsS0FDQUMsV0FBQSxNQWtCQSxTQUFBQyxlQUNBQyxTQUFBQyxjQUFBLDBCQUNBQyxpQkFBQSxRQUFBQyxVQUVBSCxTQUFBQyxjQUFBLDZCQUNBQyxpQkFBQSxRQUFBRSxhQUVBSixTQUFBQyxjQUFBLDZCQUNBQyxpQkFBQSxRQUFBRyxpQkFFQUwsU0FBQUMsY0FBQSxpQ0FDQUMsaUJBQUEsUUFBQUksbUJBRUFOLFNBQUFDLGNBQUEsNkNBQ0FDLGlCQUFBLFFBQUFLLFlBRUFQLFNBQUFDLGNBQUEsNENBQ0FDLGlCQUFBLFFBQUFNLFdBRUFSLFNBQUFDLGNBQUEsdUNBQ0FDLGlCQUFBLFFBQUFPLFVBR0EsU0FBQU4sV0FDQU8sUUFBQUMsSUFBQSxjQUdBLFNBQUFQLGNBQ0FRLGFBQUFDLFFBQUEsY0FBQUMsS0FBQUMsVUFBQXhCLFFBQUFJLGNBR0EsU0FBQXFCLGFBQ0EsSUFBQVgsRUFBQUwsU0FBQUMsY0FBQSw2QkFFQWUsRUFBQUMsb0JBRUFELEVBQUFFLE1BQUFDLElBQUFkLEVBQUFlLFVBQUFmLEVBQUFnQixhQUFBLEdBQUEsS0FDQUwsRUFBQUUsTUFBQUksS0FBQWpCLEVBQUFrQixXQUFBLEtBQ0FQLEVBQUFFLE1BQUFNLFFBQUEsUUFHQSxTQUFBUCxvQkFDQSxJQUFBRCxFQUFBUyxnQkFDQUMsRUFBQTFCLFNBQUFDLGNBQUEsNkJBQUEwQixNQUFBQyxjQUVBQyxFQUFBdEMsUUFBQUksWUFBQW1DLE9BQUFDLElBQ0EsSUFBQUEsRUFBQUMsTUFBQUosY0FBQUssT0FBQVAsSUFHQSxJQUFBLElBQUFRLEVBQUEsRUFBQUEsRUFBQUwsRUFBQU0sT0FBQUQsSUFBQSxDQUNBLElBQUFFLEVBQUFwQyxTQUFBcUMsY0FBQSxPQUNBRCxFQUFBRSxVQUFBQyxJQUFBLG9CQUVBLElBQUFDLEVBQUF4QyxTQUFBcUMsY0FBQSxPQUNBRyxFQUFBQyxZQUFBWixFQUFBSyxHQUFBRixNQUNBUSxFQUFBRixVQUFBQyxJQUFBLDBCQUVBLElBQUFHLEVBQUExQyxTQUFBcUMsY0FBQSxPQUNBSyxFQUFBRCxZQUFBRSxPQUFBZCxFQUFBSyxHQUFBVSxNQUFBQyxPQUFBLFdBQ0FILEVBQUFKLFVBQUFDLElBQUEseUJBRUFILEVBQUFVLFlBQUFOLEdBQ0FKLEVBQUFVLFlBQUFKLEdBRUExQixFQUFBOEIsWUFBQVYsR0FHQSxPQUFBcEIsRUFHQSxTQUFBUyxnQkFDQSxJQUFBVCxFQUFBaEIsU0FBQUMsY0FBQSxnQkFFQSxLQUFBZSxFQUFBK0IsaUJBQ0EvQixFQUFBZ0MsWUFBQWhDLEVBQUFpQyxZQUdBLE9BQUFqQyxFQUdBLFNBQUFYLGdCQUFBNkMsR0FDQSxJQUFBQyxFQUFBbkQsU0FBQUMsY0FBQSw2QkFBQTBCLE1BRUF5QixFQUFBcEQsU0FBQUMsY0FBQSxpQ0FDQWtELEVBQUFoQixPQUFBLEdBQ0FpQixFQUFBbEMsTUFBQW1DLE1BQUEsT0FDQUMsbUJBR0FGLEVBQUFsQyxNQUFBbUMsTUFBQSxPQUVBckMsY0FJQSxTQUFBVixvQkFDQU4sU0FBQUMsY0FBQSw2QkFBQTBCLE1BQUEsR0FFQTJCLGlCQUVBLElBQUFGLEVBQUFwRCxTQUFBQyxjQUFBLGlDQUNBbUQsRUFBQWxDLE1BQUFtQyxNQUFBLE9BQ0FELEVBQUFHLE9BR0EsU0FBQUQsaUJBQ0F0RCxTQUFBQyxjQUFBLGdCQUNBaUIsTUFBQU0sUUFBQSxPQUdBLFNBQUFqQixhQUNBLElBQUFpRCxFQUFBakUsUUFBQUcsV0FBQSxFQUFBLEVBRUFILFFBQUFFLFlBQUFrRCxPQUFBcEQsUUFBQUUsYUFBQThDLEtBQUEsRUFBQSxTQUVBa0IsaUJBQ0FDLG1CQUFBRixHQUNBRyxlQUNBQyxZQUdBLFNBQUFwRCxZQUNBLElBQUFnRCxFQUFBakUsUUFBQUcsV0FBQSxFQUFBLEVBRUFILFFBQUFFLFlBQUFrRCxPQUFBcEQsUUFBQUUsYUFBQThDLElBQUEsRUFBQSxTQUVBa0IsaUJBQ0FDLG1CQUFBRixHQUNBRyxlQUNBQyxZQUdBLFNBQUFuRCxXQUNBLElBQUErQyxFQUFBakUsUUFBQUcsV0FBQSxFQUFBLEVBRUFILFFBQUFFLFlBQUFrRCxTQUFBQyxLQUFBLEdBQUFpQixNQUFBLEdBQUFDLFFBQUEsR0FBQUMsUUFBQSxHQUVBTixpQkFDQUMsbUJBQUFGLEdBQ0FHLGVBQ0FDLFlBS0EsU0FBQUgsaUJBQ0EsSUFBQU8sSUFBQXpFLFFBQUFFLFlBQUF3RSxNQUFBLEdBRUEsSUFBQTFFLFFBQUFFLFlBQUF3RSxRQUNBRCxHQUFBLEdBR0F6RSxRQUFBSyxVQUFBK0MsT0FBQXBELFFBQUFFLGFBQUE4QyxJQUFBeUIsRUFBQSxRQUNBekUsUUFBQU0sUUFBQThDLE9BQUFwRCxRQUFBSyxXQUFBMkMsSUFBQSxHQUFBLFFBQUFBLEtBQUEsRUFBQSxXQUNBaEQsUUFBQU8sV0FBQTZDLE9BQUFwRCxRQUFBSyxXQUVBTCxRQUFBTSxRQUFBK0MsT0FBQSxHQUNBckQsUUFBQU0sUUFBQTBDLEtBQUEsRUFBQSxRQUNBaEQsUUFBQUcsWUFBQSxHQUdBSCxRQUFBRyxZQUFBLEVBSUEsU0FBQXdFLG1CQUNBLElBQUFDLEVBQUFuRSxTQUFBQyxjQUFBLHlCQUVBbUUsRUFBQTdFLFFBQUFHLFdBQUEsRUFBQSxFQUVBLElBQUEsSUFBQXdDLEVBQUEsRUFBQUEsRUFBQWtDLEVBQUFsQyxJQUFBLENBQ0EsSUFBQW1DLEVBQUFDLG1CQUNBRCxFQUFBL0IsVUFBQUMsSUFBQSw0QkFFQTRCLEVBQUFyQixZQUFBdUIsSUFJQSxTQUFBWCxtQkFBQUYsR0FDQSxJQUFBVyxFQUFBbkUsU0FBQUMsY0FBQSx5QkFFQW1FLEVBQUE3RSxRQUFBRyxXQUFBLEVBQUEsRUFFQSxHQUFBMEUsRUFBQVosRUFBQSxDQUNBLElBQUFhLEVBQUFDLG1CQUNBRCxFQUFBL0IsVUFBQUMsSUFBQSw0QkFFQTRCLEVBQUFyQixZQUFBdUIsUUFFQSxHQUFBRCxFQUFBWixFQUFBLENBQ0FjLG1CQUVBSCxFQUFBbkIsWUFBQW1CLEVBQUFJLFlBSUEsU0FBQUQsbUJBQ0EsSUFBQUUsRUFBQXhFLFNBQUFxQyxjQUFBLE9BRUEsSUFBQSxJQUFBb0MsRUFBQSxFQUFBQSxFQUFBLEVBQUFBLElBQUEsQ0FDQSxJQUFBQyxFQUFBQyxzQkFDQUQsRUFBQXBDLFVBQUFDLElBQUEsNEJBRUFpQyxFQUFBMUIsWUFBQTRCLEdBR0EsT0FBQUYsRUFHQSxTQUFBRyxzQkFDQSxJQUFBQyxFQUFBNUUsU0FBQXFDLGNBQUEsT0FDQXdDLEVBQUE3RSxTQUFBcUMsY0FBQSxRQUNBeUMsRUFBQTlFLFNBQUFxQyxjQUFBLE9BQ0EwQyxFQUFBL0UsU0FBQXFDLGNBQUEsT0FXQSxPQVRBeUMsRUFBQXhDLFVBQUFDLElBQUEsa0NBQ0F3QyxFQUFBekMsVUFBQUMsSUFBQSx3Q0FFQXFDLEVBQUE5QixZQUFBK0IsR0FDQUQsRUFBQTlCLFlBQUFnQyxHQUNBRixFQUFBOUIsWUFBQWlDLEdBRUF4RixRQUFBTyxXQUFBeUMsSUFBQSxFQUFBLFFBRUFxQyxFQUdBLFNBQUFqQixlQUNBM0QsU0FBQUMsY0FBQSw0Q0FDQXdDLFlBQUF1QyxvQkFHQSxTQUFBQSxvQkFFQSxPQUFBckMsT0FBQXBELFFBQUFFLGFBQUFvRCxPQUFBLGFBR0EsU0FBQWUsWUFDQXJFLFFBQUFPLFdBQUE2QyxPQUFBcEQsUUFBQUssV0FFQSxJQUFBcUYsRUFBQSxFQUNBQyxFQUFBQyxvQkFBQTVGLFFBQUFPLFlBRUFzRixFQUFBcEYsU0FBQUMsY0FBQSx5QkFFQSxJQUFBLElBQUFvRixFQUFBLEVBQUFBLEVBQUFELEVBQUFFLFNBQUFuRCxPQUFBa0QsSUFBQSxDQUNBLElBQUFFLEVBQUFILEVBQUFFLFNBQUFELEdBRUEsSUFBQSxJQUFBRyxFQUFBLEVBQUFBLEVBQUFELEVBQUFELFNBQUFuRCxPQUFBcUQsSUFBQSxDQUNBLElBQUFDLEVBQUFGLEVBQUFELFNBQUFFLEdBQ0FFLEVBQUFELEVBQUF4RixjQUFBLFFBRUF3RixFQUFBbkQsVUFBQXFELE9BQUEsU0FDQUYsRUFBQW5ELFVBQUFxRCxPQUFBLFNBRUFELEVBQUFqRCxZQUFBd0MsRUFBQSxFQUFBMUYsUUFBQU8sV0FBQStDLE9BQUEsUUFBQSxLQUFBLEdBQ0E2QyxFQUFBakQsYUFBQWxELFFBQUFPLFdBQUE4QyxPQUVBckQsUUFBQU8sV0FBQStDLE9BQUF0RCxRQUFBQyxnQkFBQW1ELFNBQUFrQixNQUFBLEdBQUFDLFFBQUEsR0FBQUMsUUFBQSxHQUFBbEIsT0FBQXRELFFBQUFDLGVBQ0FpRyxFQUFBbkQsVUFBQUMsSUFBQSxTQUdBLElBQUFxRCxFQUFBSCxFQUFBeEYsY0FBQSxtQ0FDQTJGLEVBQUFuRCxZQUFBLEdBQ0EsSUFBQW9ELEVBQUFKLEVBQUF4RixjQUFBLHlDQUNBNEYsRUFBQXBELFlBQUEsSUFFQSxJQUFBeUMsR0FBQUEsRUFBQTNGLFFBQUFJLFlBQUF3QyxRQUNBMkQsV0FBQVosS0FDQVUsRUFBQW5ELFlBQUFsRCxRQUFBSSxZQUFBdUYsR0FBQWxELE1BRUF5RCxFQUFBbkQsVUFBQUMsSUFBQSxTQUVBd0QsZ0JBQUFGLEVBQUFYLEdBRUFBLEtBSUFELElBQ0ExRixRQUFBTyxXQUFBeUMsSUFBQSxFQUFBLFVBS0EsU0FBQTRDLG9CQUFBdkYsR0FDQSxJQUFBb0csR0FBQSxFQUVBLElBQUEsSUFBQTlELEVBQUEsRUFBQUEsRUFBQTNDLFFBQUFJLFlBQUF3QyxPQUFBRCxJQUNBLEdBQUFTLE9BQUFwRCxRQUFBSSxZQUFBdUMsR0FBQVUsT0FBQUQsT0FBQS9DLEdBQUEsQ0FDQW9HLEVBQUE5RCxFQUNBLE1BSUEsT0FBQThELEVBR0EsU0FBQUYsV0FBQVosR0FDQSxPQUFBdkMsT0FBQXBELFFBQUFJLFlBQUF1RixHQUFBdEMsTUFBQWlCLE1BQUEsR0FBQUMsUUFBQSxHQUFBQyxRQUFBLEdBQUFsQixPQUFBdEQsUUFBQUMsZ0JBQ0FtRCxPQUFBcEQsUUFBQU8sWUFBQStELE1BQUEsR0FBQUMsUUFBQSxHQUFBQyxRQUFBLEdBQUFsQixPQUFBdEQsUUFBQUMsY0FHQSxTQUFBdUcsZ0JBQUFGLEVBQUFYLEdBQ0EsSUFBQWUsRUFBQTFHLFFBQUFJLFlBQUF1RixHQUFBZ0IsYUFBQS9ELE9BRUFnRSxFQUFBLEdBRUEsSUFBQSxJQUFBakUsRUFBQSxFQUFBQSxFQUFBK0QsRUFBQS9ELElBQ0FpRSxHQUFBNUcsUUFBQUksWUFBQXVGLEdBQUFnQixhQUFBaEUsR0FBQWtFLEtBQ0EsSUFDQTdHLFFBQUFJLFlBQUF1RixHQUFBZ0IsYUFBQWhFLEdBQUFtRSxRQUdBRixHQURBakUsSUFBQStELEVBQUEsRUFDQSxJQUdBLEtBSUFKLEVBQUFwRCxZQUFBMEQsRUFHQSxTQUFBRyxXQUdBLEdBRkEvRyxRQUFBSSxZQUFBbUIsS0FBQXlGLE1BQUEzRixhQUFBNEYsUUFBQSxnQkFFQSxPQUFBakgsUUFBQUksWUFBQSxDQUNBLElBQUE4RyxFQUFBLElBQUFDLGVBRUFELEVBQUFFLG1CQUFBLFdBQ0EsSUFBQUYsRUFBQUcsWUFDQSxNQUFBSCxFQUFBSSxTQUNBdEgsUUFBQUksWUFBQW1CLEtBQUF5RixNQUFBRSxFQUFBSyxjQUFBQyxPQUVBeEgsUUFBQUksWUFBQXFILEtBQUEsQ0FBQUMsRUFBQUMsSUFBQXZFLE9BQUFzRSxFQUFBckUsTUFBQUQsT0FBQXVFLEVBQUF0RSxPQUVBZ0IsY0FLQTZDLEVBQUFVLEtBQUEsTUFBQSxpQkFBQSxHQUNBVixFQUFBVyxZQUdBN0gsUUFBQUksWUFBQXFILEtBQUEsQ0FBQUMsRUFBQUMsSUFBQXZFLE9BQUFzRSxFQUFBckUsTUFBQUQsT0FBQXVFLEVBQUF0RSxPQUVBZ0IsWUF6V0F5RCxPQUFBQyxPQUFBLFdBQ0EvSCxRQUFBRSxZQUFBa0QsU0FBQUMsS0FBQSxHQUFBaUIsTUFBQSxHQUFBQyxRQUFBLEdBQUFDLFFBQUEsR0FFQWhFLGVBQ0EwRCxpQkFDQVMsbUJBQ0FQLGVBQ0EyQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuLy8gdmFyXHJcblxyXG5sZXQgc3RvcmFnZSA9IHtcclxuICAgIGN1cmVudEZvcm1hdDogJ1lZWVktTU0tREQnLFxyXG4gICAgY3VyZW50TW9udGg6IG51bGwsXHJcbiAgICBsb25nUGVyaW9kOiBmYWxzZSxcclxuICAgIHRhYmxlRXZlbnRzOiBudWxsLFxyXG4gICAgc3RhcnREYXRlOiBudWxsLFxyXG4gICAgZW5kRGF0ZTogbnVsbCxcclxuICAgIG91dHB1dERhdGU6IG51bGxcclxufVxyXG5cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcblxyXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgc3RvcmFnZS5jdXJlbnRNb250aCA9IG1vbWVudCgpLmRhdGUoMSkuaG91cnMoMCkubWludXRlcygwKS5zZWNvbmRzKDApO1xyXG5cclxuICAgIHNldFVwQnV0dG9ucygpO1xyXG4gICAgY2FsY3VsYXRlRGF0ZXMoKTtcclxuICAgIGJ1aWxkTGF5b3V0VGFibGUoKTtcclxuICAgIG91dHB1dFBlcmlvZCgpO1xyXG4gICAgcmVhZERhdGEoKTtcclxufVxyXG5cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbi8vIEV2ZW50c1xyXG5cclxuZnVuY3Rpb24gc2V0VXBCdXR0b25zKCkge1xyXG4gICAgbGV0IGJ0bkFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay1oZWFkZXJfX2J0bi1hZGQnKTtcclxuICAgIGJ0bkFkZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFkZEV2ZW50KTtcclxuXHJcbiAgICBsZXQgYnRuVXBkYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJsb2NrLWhlYWRlcl9fYnRuLXVwZGF0ZScpO1xyXG4gICAgYnRuVXBkYXRlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdXBkYXRlRXZlbnQpO1xyXG5cclxuICAgIGxldCBmaWVsZEZpbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxvY2staGVhZGVyX19maW5kX2ZpZWxkJyk7XHJcbiAgICBmaWVsZEZpbmQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmaWVsZEZpbmRFdmVudHMpO1xyXG5cclxuICAgIGxldCBidG5DbGVhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay1oZWFkZXJfX2ZpbmRfYnRuLWNsZWFyJyk7XHJcbiAgICBidG5DbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZpZWxkRmluZEJ0bkNsZWFyKTtcclxuXHJcbiAgICBsZXQgYnRuTW9udGhNaW51cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX19zZWxlY3QtcGVyaW9kX21vbnRoLW1pbnVzJyk7XHJcbiAgICBidG5Nb250aE1pbnVzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbW9udGhNaW51cyk7XHJcblxyXG4gICAgbGV0IGJ0bk1vbnRoUGx1cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX19zZWxlY3QtcGVyaW9kX21vbnRoLXBsdXMnKTtcclxuICAgIGJ0bk1vbnRoUGx1cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG1vbnRoUGx1cyk7XHJcblxyXG4gICAgbGV0IGJ0blRvZGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tZGF0ZXNfX3NlbGVjdC1wZXJpb2RfdG9kYXknKTtcclxuICAgIGJ0blRvZGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2V0VG9kYXkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRFdmVudCgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdhZGRFdmVudCgpJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUV2ZW50KCkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FycmF5RXZlbnRzJywgSlNPTi5zdHJpbmdpZnkoc3RvcmFnZS50YWJsZUV2ZW50cykpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmaW5kRXZlbnRzKCkge1xyXG4gICAgbGV0IGZpZWxkRmluZEV2ZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay1oZWFkZXJfX2ZpbmRfZmllbGQnKTtcclxuXHJcbiAgICBsZXQgZmluZEV2ZW50cyA9IHNlYXJjaFRpdGxlRXZlbnRzKCk7XHJcblxyXG4gICAgZmluZEV2ZW50cy5zdHlsZS50b3AgPSAoZmllbGRGaW5kRXZlbnRzLm9mZnNldFRvcCArIGZpZWxkRmluZEV2ZW50cy5vZmZzZXRIZWlnaHQgKyAxMykgKyAncHgnO1xyXG4gICAgZmluZEV2ZW50cy5zdHlsZS5sZWZ0ID0gZmllbGRGaW5kRXZlbnRzLm9mZnNldExlZnQgKyAncHgnO1xyXG4gICAgZmluZEV2ZW50cy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxufVxyXG5cclxuZnVuY3Rpb24gc2VhcmNoVGl0bGVFdmVudHMoKSB7XHJcbiAgICBsZXQgZmluZEV2ZW50cyA9IGdldEZpbmRFdmVudHMoKTtcclxuICAgIGxldCBzZWFyY2hWYWx1ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay1oZWFkZXJfX2ZpbmRfZmllbGQnKS52YWx1ZS50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgIGxldCByZXN1bHRTZWFyY2ggPSBzdG9yYWdlLnRhYmxlRXZlbnRzLmZpbHRlcigoaXRlbSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBpdGVtLnRpdGxlLnRvTG93ZXJDYXNlKCkuc2VhcmNoKHNlYXJjaFZhbHVlKSAhPT0gLTE7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdFNlYXJjaC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGxldCBmaW5kRXZlbnRzUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgZmluZEV2ZW50c1Jvdy5jbGFzc0xpc3QuYWRkKCdmaW5kLWV2ZW50c19fcm93Jyk7XHJcblxyXG4gICAgICAgIGxldCByb3dUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHJvd1RpdGxlLnRleHRDb250ZW50ID0gcmVzdWx0U2VhcmNoW2ldLnRpdGxlO1xyXG4gICAgICAgIHJvd1RpdGxlLmNsYXNzTGlzdC5hZGQoJ2ZpbmQtZXZlbnRzX19yb3dfdGl0bGUnKTtcclxuXHJcbiAgICAgICAgbGV0IHJvd0luZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICByb3dJbmZvLnRleHRDb250ZW50ID0gbW9tZW50KHJlc3VsdFNlYXJjaFtpXS5kYXRlKS5mb3JtYXQoJ0RvIE1NTU0nKTtcclxuICAgICAgICByb3dJbmZvLmNsYXNzTGlzdC5hZGQoJ2ZpbmQtZXZlbnRzX19yb3dfSW5mbycpO1xyXG5cclxuICAgICAgICBmaW5kRXZlbnRzUm93LmFwcGVuZENoaWxkKHJvd1RpdGxlKTtcclxuICAgICAgICBmaW5kRXZlbnRzUm93LmFwcGVuZENoaWxkKHJvd0luZm8pO1xyXG5cclxuICAgICAgICBmaW5kRXZlbnRzLmFwcGVuZENoaWxkKGZpbmRFdmVudHNSb3cpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmaW5kRXZlbnRzO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRGaW5kRXZlbnRzKCkge1xyXG4gICAgbGV0IGZpbmRFdmVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZmluZC1ldmVudHMnKTtcclxuXHJcbiAgICB3aGlsZSAoZmluZEV2ZW50cy5oYXNDaGlsZE5vZGVzKCkpIHsgICBcclxuICAgICAgICBmaW5kRXZlbnRzLnJlbW92ZUNoaWxkKGZpbmRFdmVudHMuZmlyc3RDaGlsZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZpbmRFdmVudHM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpZWxkRmluZEV2ZW50cyhlKSB7XHJcbiAgICBsZXQgc2VhcmNoaW5nVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay1oZWFkZXJfX2ZpbmRfZmllbGQnKS52YWx1ZTtcclxuXHJcbiAgICBsZXQgYnRuQ2xlYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxvY2staGVhZGVyX19maW5kX2J0bi1jbGVhcicpO1xyXG4gICAgaWYgKHNlYXJjaGluZ1RleHQubGVuZ3RoIDwgMykge1xyXG4gICAgICAgIGJ0bkNsZWFyLnN0eWxlLmNvbG9yID0gJyNmZmYnO1xyXG4gICAgICAgIGhpZGVGaW5kRXZlbnRzKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBidG5DbGVhci5zdHlsZS5jb2xvciA9ICcjMDAwJztcclxuXHJcbiAgICAgICAgZmluZEV2ZW50cygpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBmaWVsZEZpbmRCdG5DbGVhcigpIHtcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9jay1oZWFkZXJfX2ZpbmRfZmllbGQnKS52YWx1ZSA9ICcnO1xyXG5cclxuICAgIGhpZGVGaW5kRXZlbnRzKCk7XHJcblxyXG4gICAgbGV0IGJ0bkNsZWFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJsb2NrLWhlYWRlcl9fZmluZF9idG4tY2xlYXInKTtcclxuICAgIGJ0bkNsZWFyLnN0eWxlLmNvbG9yID0gJyNmZmYnO1xyXG4gICAgYnRuQ2xlYXIuYmx1cigpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoaWRlRmluZEV2ZW50cygpIHtcclxuICAgIGxldCBmaW5kRXZlbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZpbmQtZXZlbnRzJyk7XHJcbiAgICBmaW5kRXZlbnRzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1vbnRoTWludXMoKSB7XHJcbiAgICBsZXQgcHJldk1heFJvd3MgPSBzdG9yYWdlLmxvbmdQZXJpb2QgPyA2IDogNTtcclxuXHJcbiAgICBzdG9yYWdlLmN1cmVudE1vbnRoID0gbW9tZW50KHN0b3JhZ2UuY3VyZW50TW9udGgpLmFkZCgtMSwgJ21vbnRoJyk7XHJcblxyXG4gICAgY2FsY3VsYXRlRGF0ZXMoKTtcclxuICAgIGNvcnJlY3RMYXlvdXRUYWJsZShwcmV2TWF4Um93cyk7XHJcbiAgICBvdXRwdXRQZXJpb2QoKTtcclxuICAgIGZpbGxUYWJsZSgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtb250aFBsdXMoKSB7XHJcbiAgICBsZXQgcHJldk1heFJvd3MgPSBzdG9yYWdlLmxvbmdQZXJpb2QgPyA2IDogNTtcclxuXHJcbiAgICBzdG9yYWdlLmN1cmVudE1vbnRoID0gbW9tZW50KHN0b3JhZ2UuY3VyZW50TW9udGgpLmFkZCgrMSwgJ21vbnRoJyk7XHJcblxyXG4gICAgY2FsY3VsYXRlRGF0ZXMoKTtcclxuICAgIGNvcnJlY3RMYXlvdXRUYWJsZShwcmV2TWF4Um93cyk7XHJcbiAgICBvdXRwdXRQZXJpb2QoKTtcclxuICAgIGZpbGxUYWJsZSgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRUb2RheSgpIHtcclxuICAgIGxldCBwcmV2TWF4Um93cyA9IHN0b3JhZ2UubG9uZ1BlcmlvZCA/IDYgOiA1O1xyXG5cclxuICAgIHN0b3JhZ2UuY3VyZW50TW9udGggPSBtb21lbnQoKS5kYXRlKDEpLmhvdXJzKDApLm1pbnV0ZXMoMCkuc2Vjb25kcygwKTtcclxuXHJcbiAgICBjYWxjdWxhdGVEYXRlcygpO1xyXG4gICAgY29ycmVjdExheW91dFRhYmxlKHByZXZNYXhSb3dzKTtcclxuICAgIG91dHB1dFBlcmlvZCgpO1xyXG4gICAgZmlsbFRhYmxlKCk7XHJcbn1cclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5cclxuZnVuY3Rpb24gY2FsY3VsYXRlRGF0ZXMoKSB7XHJcbiAgICBsZXQgc2hpZnREYXRlID0gLShzdG9yYWdlLmN1cmVudE1vbnRoLmRheSgpIC0gMSk7XHJcblxyXG4gICAgaWYgKHN0b3JhZ2UuY3VyZW50TW9udGguZGF5KCkgPT09IDApIHtcclxuICAgICAgICBzaGlmdERhdGUgPSAtNjtcclxuICAgIH1cclxuXHJcbiAgICBzdG9yYWdlLnN0YXJ0RGF0ZSA9IG1vbWVudChzdG9yYWdlLmN1cmVudE1vbnRoKS5hZGQoc2hpZnREYXRlLCAnZGF5cycpO1xyXG4gICAgc3RvcmFnZS5lbmREYXRlID0gbW9tZW50KHN0b3JhZ2Uuc3RhcnREYXRlKS5hZGQoNDIsICdkYXlzJykuYWRkKC0xLCdzZWNvbmRzJyk7XHJcbiAgICBzdG9yYWdlLm91dHB1dERhdGUgPSBtb21lbnQoc3RvcmFnZS5zdGFydERhdGUpO1xyXG5cclxuICAgIGlmIChzdG9yYWdlLmVuZERhdGUuZGF0ZSgpID4gNiApIHtcclxuICAgICAgICBzdG9yYWdlLmVuZERhdGUuYWRkKC03LCAnZGF5cycpO1xyXG4gICAgICAgIHN0b3JhZ2UubG9uZ1BlcmlvZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgc3RvcmFnZS5sb25nUGVyaW9kID0gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYnVpbGRMYXlvdXRUYWJsZSgpIHtcclxuICAgIGxldCBzZWN0aW9uRGF0ZXNUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX190YWJsZScpO1xyXG5cclxuICAgIGxldCBtYXhSb3dzID0gc3RvcmFnZS5sb25nUGVyaW9kID8gNiA6IDU7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhSb3dzOyBpKyspIHtcclxuICAgICAgICBsZXQgc2VjdGlvbkRhdGVzVGFibGVSb3cgPSBnZW5lcmF0ZVRhYmxlUm93KCk7XHJcbiAgICAgICAgc2VjdGlvbkRhdGVzVGFibGVSb3cuY2xhc3NMaXN0LmFkZCgnc2VjdGlvbi1kYXRlc19fdGFibGVfcm93Jyk7XHJcblxyXG4gICAgICAgIHNlY3Rpb25EYXRlc1RhYmxlLmFwcGVuZENoaWxkKHNlY3Rpb25EYXRlc1RhYmxlUm93KTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29ycmVjdExheW91dFRhYmxlKHByZXZNYXhSb3dzKSB7XHJcbiAgICBsZXQgc2VjdGlvbkRhdGVzVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi1kYXRlc19fdGFibGUnKTtcclxuXHJcbiAgICBsZXQgbWF4Um93cyA9IHN0b3JhZ2UubG9uZ1BlcmlvZCA/IDYgOiA1O1xyXG5cclxuICAgIGlmIChtYXhSb3dzID4gcHJldk1heFJvd3MpIHtcclxuICAgICAgICBsZXQgc2VjdGlvbkRhdGVzVGFibGVSb3cgPSBnZW5lcmF0ZVRhYmxlUm93KCk7XHJcbiAgICAgICAgc2VjdGlvbkRhdGVzVGFibGVSb3cuY2xhc3NMaXN0LmFkZCgnc2VjdGlvbi1kYXRlc19fdGFibGVfcm93Jyk7XHJcblxyXG4gICAgICAgIHNlY3Rpb25EYXRlc1RhYmxlLmFwcGVuZENoaWxkKHNlY3Rpb25EYXRlc1RhYmxlUm93KTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKG1heFJvd3MgPCBwcmV2TWF4Um93cykge1xyXG4gICAgICAgIGxldCBzZWN0aW9uRGF0ZXNUYWJsZVJvdyA9IGdlbmVyYXRlVGFibGVSb3coKTtcclxuXHJcbiAgICAgICAgc2VjdGlvbkRhdGVzVGFibGUucmVtb3ZlQ2hpbGQoc2VjdGlvbkRhdGVzVGFibGUubGFzdENoaWxkKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVUYWJsZVJvdygpIHtcclxuICAgIGxldCB0YWJsZVJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cclxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgNzsgeSsrKSB7XHJcbiAgICAgICAgbGV0IHNlY3Rpb25EYXRlc1RhYmxlQ29sID0gZ2VuZXJhdGVUYWJsZVJvd0NvbCgpO1xyXG4gICAgICAgIHNlY3Rpb25EYXRlc1RhYmxlQ29sLmNsYXNzTGlzdC5hZGQoJ3NlY3Rpb24tZGF0ZXNfX3RhYmxlX2NvbCcpO1xyXG5cclxuICAgICAgICB0YWJsZVJvdy5hcHBlbmRDaGlsZChzZWN0aW9uRGF0ZXNUYWJsZUNvbCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRhYmxlUm93O1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZVRhYmxlUm93Q29sKCkge1xyXG4gICAgbGV0IHRhYmxlUm93Q29sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBsZXQgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuICAgIGxldCBkaXYxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBsZXQgZGl2MiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cclxuICAgIGRpdjEuY2xhc3NMaXN0LmFkZCgnc2VjdGlvbi1kYXRlc19fdGFibGVfY29sLWV2ZW50Jyk7XHJcbiAgICBkaXYyLmNsYXNzTGlzdC5hZGQoJ3NlY3Rpb24tZGF0ZXNfX3RhYmxlX2NvbC1wYXJ0aWNpcGFudCcpO1xyXG5cclxuICAgIHRhYmxlUm93Q29sLmFwcGVuZENoaWxkKHNwYW4pO1xyXG4gICAgdGFibGVSb3dDb2wuYXBwZW5kQ2hpbGQoZGl2MSk7XHJcbiAgICB0YWJsZVJvd0NvbC5hcHBlbmRDaGlsZChkaXYyKTtcclxuXHJcbiAgICBzdG9yYWdlLm91dHB1dERhdGUuYWRkKDEsICdkYXlzJyk7XHJcbiAgICBcclxuICAgIHJldHVybiB0YWJsZVJvd0NvbDtcclxufVxyXG5cclxuZnVuY3Rpb24gb3V0cHV0UGVyaW9kKCkge1xyXG4gICAgbGV0IHNlbGVjdGVkUGVyaW9kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24tZGF0ZXNfX3NlbGVjdC1wZXJpb2RfbW9udGgtdGV4dCcpO1xyXG4gICAgc2VsZWN0ZWRQZXJpb2QudGV4dENvbnRlbnQgPSBnZXRTZWxlY3RlZFBlcmlvZCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRTZWxlY3RlZFBlcmlvZCgpIHtcclxuICAgIC8vIG1vbWVudC5sb2NhbGUoJ3J1Jyk7XHJcbiAgICByZXR1cm4gbW9tZW50KHN0b3JhZ2UuY3VyZW50TW9udGgpLmZvcm1hdCgnTU1NTSBZWVlZJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbGxUYWJsZSgpIHtcclxuICAgIHN0b3JhZ2Uub3V0cHV0RGF0ZSA9IG1vbWVudChzdG9yYWdlLnN0YXJ0RGF0ZSk7XHJcblxyXG4gICAgbGV0IGNvdW50RGF0ZSA9IDA7XHJcbiAgICBsZXQgZmlyc3RFdmVudEluZGV4ID0gZmluZEZpcnN0RXZlbnRJbmRleChzdG9yYWdlLm91dHB1dERhdGUpO1xyXG5cclxuICAgIGxldCBjdXJUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX190YWJsZScpO1xyXG5cclxuICAgIGZvciAobGV0IHIgPSAwOyByIDwgY3VyVGFibGUuY2hpbGRyZW4ubGVuZ3RoOyByKyspIHtcclxuICAgICAgICBsZXQgY2hpbGRyZW5Sb3cgPSBjdXJUYWJsZS5jaGlsZHJlbltyXTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjaGlsZHJlblJvdy5jaGlsZHJlbi5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICBsZXQgY3VyVGFibGVDb2wgPSBjaGlsZHJlblJvdy5jaGlsZHJlbltjXTtcclxuICAgICAgICAgICAgbGV0IGN1clRhYmxlQ29sU3BhbiA9IGN1clRhYmxlQ29sLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTtcclxuXHJcbiAgICAgICAgICAgIGN1clRhYmxlQ29sLmNsYXNzTGlzdC5yZW1vdmUoJ3RvZGF5Jyk7XHJcbiAgICAgICAgICAgIGN1clRhYmxlQ29sLmNsYXNzTGlzdC5yZW1vdmUoJ2V2ZW50Jyk7XHJcblxyXG4gICAgICAgICAgICBjdXJUYWJsZUNvbFNwYW4udGV4dENvbnRlbnQgPSBjb3VudERhdGUgPCA3ID8gc3RvcmFnZS5vdXRwdXREYXRlLmZvcm1hdCgnZGRkZCcpICsgJywgJyA6ICcnO1xyXG4gICAgICAgICAgICBjdXJUYWJsZUNvbFNwYW4udGV4dENvbnRlbnQgKz0gc3RvcmFnZS5vdXRwdXREYXRlLmRhdGUoKTtcclxuICAgIFxyXG4gICAgICAgICAgICBpZiAoc3RvcmFnZS5vdXRwdXREYXRlLmZvcm1hdChzdG9yYWdlLmN1cmVudEZvcm1hdCkgPT09IG1vbWVudCgpLmhvdXJzKDApLm1pbnV0ZXMoMCkuc2Vjb25kcygwKS5mb3JtYXQoc3RvcmFnZS5jdXJlbnRGb3JtYXQpKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJUYWJsZUNvbC5jbGFzc0xpc3QuYWRkKCd0b2RheScpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgY3VyVGFibGVDb2xFdmVudCA9IGN1clRhYmxlQ29sLnF1ZXJ5U2VsZWN0b3IoJy5zZWN0aW9uLWRhdGVzX190YWJsZV9jb2wtZXZlbnQnKTtcclxuICAgICAgICAgICAgY3VyVGFibGVDb2xFdmVudC50ZXh0Q29udGVudCA9ICcnO1xyXG4gICAgICAgICAgICBsZXQgY3VyVGFibGVDb2xQYXJ0aWNpcGFudHMgPSBjdXJUYWJsZUNvbC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbi1kYXRlc19fdGFibGVfY29sLXBhcnRpY2lwYW50Jyk7XHJcbiAgICAgICAgICAgIGN1clRhYmxlQ29sUGFydGljaXBhbnRzLnRleHRDb250ZW50ID0gJyc7XHJcblxyXG4gICAgICAgICAgICBpZiAoKGZpcnN0RXZlbnRJbmRleCAhPT0gLTEpICYmIChmaXJzdEV2ZW50SW5kZXggPCBzdG9yYWdlLnRhYmxlRXZlbnRzLmxlbmd0aCkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcXVhbERhdGVzKGZpcnN0RXZlbnRJbmRleCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJUYWJsZUNvbEV2ZW50LnRleHRDb250ZW50ID0gc3RvcmFnZS50YWJsZUV2ZW50c1tmaXJzdEV2ZW50SW5kZXhdLnRpdGxlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjdXJUYWJsZUNvbC5jbGFzc0xpc3QuYWRkKCdldmVudCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhZGRQYXJ0aWNpcGFudHMoY3VyVGFibGVDb2xQYXJ0aWNpcGFudHMsIGZpcnN0RXZlbnRJbmRleCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0RXZlbnRJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb3VudERhdGUrKztcclxuICAgICAgICAgICAgc3RvcmFnZS5vdXRwdXREYXRlLmFkZCgxLCAnZGF5cycpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZmluZEZpcnN0RXZlbnRJbmRleChzdGFydERhdGUpIHtcclxuICAgIGxldCBjdXJJbmRleCA9IC0xO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RvcmFnZS50YWJsZUV2ZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChtb21lbnQoc3RvcmFnZS50YWJsZUV2ZW50c1tpXS5kYXRlKSA+PSBtb21lbnQoc3RhcnREYXRlKSkge1xyXG4gICAgICAgICAgICBjdXJJbmRleCA9IGk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY3VySW5kZXg7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGVxdWFsRGF0ZXMoZmlyc3RFdmVudEluZGV4KSB7XHJcbiAgICByZXR1cm4gbW9tZW50KHN0b3JhZ2UudGFibGVFdmVudHNbZmlyc3RFdmVudEluZGV4XS5kYXRlKS5ob3VycygwKS5taW51dGVzKDApLnNlY29uZHMoMCkuZm9ybWF0KHN0b3JhZ2UuY3VyZW50Rm9ybWF0KVxyXG4gICAgICAgICAgID09PSBtb21lbnQoc3RvcmFnZS5vdXRwdXREYXRlKS5ob3VycygwKS5taW51dGVzKDApLnNlY29uZHMoMCkuZm9ybWF0KHN0b3JhZ2UuY3VyZW50Rm9ybWF0KTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkUGFydGljaXBhbnRzKGN1clRhYmxlQ29sUGFydGljaXBhbnRzLCBmaXJzdEV2ZW50SW5kZXgpIHtcclxuICAgIGxldCBxdWFudFBhcnRpY2lwYW50cyA9IHN0b3JhZ2UudGFibGVFdmVudHNbZmlyc3RFdmVudEluZGV4XS5wYXJ0aWNpcGFudHMubGVuZ3RoO1xyXG5cclxuICAgIGxldCBsaXN0UGFydGljaXBhbnRzID0gJyc7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWFudFBhcnRpY2lwYW50czsgaSsrKSB7XHJcbiAgICAgICAgbGlzdFBhcnRpY2lwYW50cyArPSBzdG9yYWdlLnRhYmxlRXZlbnRzW2ZpcnN0RXZlbnRJbmRleF0ucGFydGljaXBhbnRzW2ldLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICsgJyAnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICArIHN0b3JhZ2UudGFibGVFdmVudHNbZmlyc3RFdmVudEluZGV4XS5wYXJ0aWNpcGFudHNbaV0uc3VybmFtZTtcclxuXHJcbiAgICAgICAgaWYgKGkgPT09IChxdWFudFBhcnRpY2lwYW50cyAtIDEpKSB7XHJcbiAgICAgICAgICAgIGxpc3RQYXJ0aWNpcGFudHMgKz0gJy4nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGlzdFBhcnRpY2lwYW50cyArPSAnLCAnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjdXJUYWJsZUNvbFBhcnRpY2lwYW50cy50ZXh0Q29udGVudCA9IGxpc3RQYXJ0aWNpcGFudHM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlYWREYXRhKCkge1xyXG4gICAgc3RvcmFnZS50YWJsZUV2ZW50cyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FycmF5RXZlbnRzJykpO1xyXG5cclxuICAgIGlmIChzdG9yYWdlLnRhYmxlRXZlbnRzID09PSBudWxsKSB7XHJcbiAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG5cclxuICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlLnRhYmxlRXZlbnRzID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KS5ldmVudHM7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBzdG9yYWdlLnRhYmxlRXZlbnRzLnNvcnQoKGZpcnN0LCBzZWNvbmQpID0+IChtb21lbnQoZmlyc3QuZGF0ZSkgLSBtb21lbnQoc2Vjb25kLmRhdGUpKSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBmaWxsVGFibGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIHhoci5vcGVuKCdHRVQnLCAnLi9ldmVudHMuanNvbicsIHRydWUpO1xyXG4gICAgICAgIHhoci5zZW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgc3RvcmFnZS50YWJsZUV2ZW50cy5zb3J0KChmaXJzdCwgc2Vjb25kKSA9PiAobW9tZW50KGZpcnN0LmRhdGUpIC0gbW9tZW50KHNlY29uZC5kYXRlKSkpO1xyXG5cclxuICAgICAgICBmaWxsVGFibGUoKTtcclxuICAgIH1cclxufSJdfQ==
